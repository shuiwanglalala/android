# 共享文件

## 响应文件选择

您可以不使用 `Uri.fromFile()`，而使用 [URI 权限](https://developer.android.com/training/secure-file-sharing/share-file?hl=zh-cn#GrantPermissions)来授予其他应用对特定 URI 的访问权限。虽然 URI 权限不适用于`Uri.fromFile()`生成的`file://` URI，但它们适用于与内容提供程序关联的 URI。`FileProvider` API 可以帮助您创建此类 URI。此方法也适用于未存储在外部存储空间中，而是存储在发送 intent 的应用的本地存储空间中的文件

请记住，您只能为特定的文件生成内容 URI，该文件需要位于包含 `` 元素的元数据文件所指定的目录中。如果您针对未指定的路径中的 `File` 调用 `getUriForFile()`，将会收到 `IllegalArgumentException`

## 授予文件访问权限

您已经获得了要与其他应用共享的文件的内容 URI，现在要做的就是允许客户端应用访问该文件。如需允许访问，您需要向客户端应用授予访问权限，方法是将该内容 URI 添加到 `Intent` 中，然后在该 `Intent` 上设置权限标记。您授予的是临时权限，这些权限会在接收方应用的任务堆栈完成时自动过期

**注意**：调用 `setFlags()` 是利用临时访问权限安全地授予文件访问权限的唯一方法。请不要对文件的内容 URI 调用 `Context.grantUriPermission()` 方法，因为该方法授予的访问权限只能通过调用 `Context.revokeUriPermission()` 来撤消

请勿使用 `Uri.fromFile()`，原因如下：它会强制接收方应用必须具有 `READ_EXTERNAL_STORAGE` 权限；如果您尝试在多个用户之间进行共享，此方法将完全行不通；在低于 4.4（API 级别 19）的 Android 版本中，要求应用具有 `WRITE_EXTERNAL_STORAGE` 权限，而 Gmail 应用等非常重要的共享目标并没有 `READ_EXTERNAL_STORAGE` 权限，这会导致此调用失败。相反，您可以使用 URI 权限来授予其他应用对特定 URI 的访问权限。虽然 URI 权限不适用于由 `Uri.fromFile()` 生成的 file:// URI，但适用于与内容提供器相关联的 URI。您可以并且应该使用`FileProvider`（如[文件共享](https://developer.android.com/training/secure-file-sharing?hl=zh-cn)中所述），而不是仅针对此实现