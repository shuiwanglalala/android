# 内容提供程序基础知识

## 概览

### 内容 URI

**内容 URI** 用来在提供程序中标识数据。内容 URI 包括整个提供程序的符号名称（其**授权**）和指向表的名称（**路径**）

`ContentProvider` 使用内容 URI 的路径部分选择需访问的表。通常，提供程序会为其公开的每个表显示一条**路径**

许多提供程序都允许通过将 ID 值追加到 URI 末尾以访问表中的单个行

## 从提供程序检索数据

### 构建查询

查询应返回的列集称为**投影**（变量 `mProjection`）

对于指定待检索行的表达式，我们将其拆分为选择子句和选择参数。选择子句是逻辑和布尔表达式、列名称以及值（变量 `mSelectionClause`）的组合。如果您指定可替换参数 `?` 而非值，查询方法会从选择参数数组（变量 `mSelectionArgs`）中检索值

#### 防止恶意输入

为了避免此问题，请使用将 `?` 作为可替换参数的选择子句，以及单独的选择参数数组。执行此操作时，用户输入直接受查询约束，而不不会被解释为 SQL 语句的一部分。由于用户输入未作为 SQL 处理，因此其无法注入恶意 SQL。请使用此选择子句，而不要使用串联以包含用户输入

## 内容提供程序权限

提供程序的应用可以指定其他应用访问提供程序的数据所必需具有的权限。这些权限可确保用户了解应用将尝试访问的数据。根据提供程序的要求，其他应用会请求其访问该提供程序时所需的权限。最终用户会在安装应用时看到所请求的权限

如需获取访问提供程序所需的权限，应用需通过其清单文件中的 `` 元素请求这些权限。Android 软件包管理器安装应用时，用户必须批准该应用请求的所有权限。如果用户批准所有权限，软件包管理器将继续安装；如果用户未批准这些权限，软件包管理器将中止安装

## 插入、更新和删除数据

### 插入数据

如需将数据插入提供程序，您可以调用 `ContentResolver.insert()` 方法。此方法会在提供程序中插入新行，并为该行返回内容 URI

如果您不想指定值，则可以使用 `ContentValues.putNull()` 将列设置为 `null`

### 删除数据

删除行与检索行数据类似：为需要删除的行指定选择条件，客户端方法会返回已删除的行数

## 提供程序数据类型

内容提供程序可以提供多种不同的数据类型。用户字典提供程序仅提供文本，但提供程序也能提供以下格式

- 整数
- 长整型 (long)
- 浮点型
- 长浮点型 (double)

提供程序经常使用的另一种数据类型是作为 64KB 字节的数组实施的二进制大型对象 (BLOB)

提供程序还会为其定义的每个内容 URI 维护 MIME（多用途互联网邮件扩展）数据类型信息。您可以使用 MIME 类型信息查明应用是否可以处理提供程序提供的数据，或根据 MIME 类型选择处理类型。在使用包含复杂数据结构或文件的提供程序时，您通常需要 MIME 类型

## 提供程序访问的替代形式

### 批量访问??

### 通过 Intent 访问数据

#### 通过临时权限获取访问权限

即使没有适当的访问权限，您也可通过以下方式访问内容提供程序中的数据：将 Intent 发送至拥有权限的应用，然后接收包含“URI”权限的结果 Intent。这些是特定内容 URI 的权限，将持续至接收该权限的 Activity 结束。拥有永久权限的应用会在结果 Intent 中设置标记，从而授予临时权限

- **读取权限**： `FLAG_GRANT_READ_URI_PERMISSION`
- **写入权限**： `FLAG_GRANT_WRITE_URI_PERMISSION`

#### 使用其他应用

如需允许用户修改您无权访问的数据，一种简单方法是激活拥有权限的应用，并让用户使用该应用执行修改

#### 使用帮助程序应用显示数据

如果您的应用具有访问权限，您可能仍想使用 Intent 在其他应用中显示数据

## MIME 类型引用

自定义 MIME 类型字符串（也称为“特定于供应商”的 MIME 类型）具有更加复杂的类型和子类型值。类型值始终为

```
vnd.android.cursor.dir
```

（多行）或

```
vnd.android.cursor.item
```

（单行）

子类型取决于提供程序