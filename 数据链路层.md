# 数据链路层

+ 数据链路层功能概述
  + 加强物理层传输原始比特流的能力，将物理层提供的可能出错的网络连接改造成逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路
    + 为网络层提供服务
      + 无确认无连接服务
      + 有确认无连接服务
    + 有确认面向连接服务
    + 链路管理，即连接的建立、维持、释放（用于面向连接的服务）
    + 组帧
    + 流量控制
    + 差错控制（帧错/位错）
+ 封装成帧 透明传输
  + 封装成帧
    + 字符计数法 帧首部使用一个计数字段（第一个字节，八位）来表明帧内字符数
    + 字符填充法 SOH EOT
      + 当传送的帧是文本文件组成时（文本文件的字符都是从键盘上输入，都是ASCII码），不管从键盘上输入什么字符都可以放在帧里传过去，即透明传输
      + 当传送的帧由非ASCII码组成时，就要采用字符填充法实现透明传输
    + 零比特填充法 51 10 晕倒连续5个1，就插入一个0
    + 违规编码法 用“高高”、“低低”定义帧的起始和结束
  + 透明传输
  + 帧同步：接收方应当能从收到二进制比特流中区分出帧的起始和终止
+ 差错控制
  + 差错
    + 位错
    + 帧错 丢失 重复 失序
  + 检错编码
  + 奇偶校验码
    + 循环冗余码CRC
      + 最终发送的数据=要发送的数据+帧检验序列FCS
      + 先加0（生产多项式的阶数），再异或（同0异1）
  + 纠错编码
    + 海明码 发现双比特错，纠正单比特错
      + 确定校验码位数r  2[r]>=k+r+1
      + 确定校验码和数据的位置 校验码只能放在2的几次方位置

+ 流量控制与可靠传输机制
  + 与传输层流量控制的区别
    + 数据链路层的流量控制时点对点的，而传输层的流量控制是端到端的
    + 数据链路层流量控制手段是接收方收不下就不回复确认，而传输层流量控制手段是接收端给发送端一个窗口公告
  + 流量控制的方法
    + 停止-等待协议 每发完一个帧就停止发送，等待对方的确认，在收到确认后再发送下一个帧
      + 发送窗口大小=1，接收窗口大小=1
    + 滑动窗口协议
      + 后退N帧协议 GBN
        + (用n个bite对帧编号) 2[n]-1>=发送窗口大小>=1，接收窗口大小=1
        + GBN发送方必须响应的三件事
          + 上层的调用
          + 收到一个ACK 对n号帧的确认采用累计确认，标明接收方已经收到n号帧和它之前的全部帧
          + 超时事件 如果发送超时，发送方会重传所有已发送但未被确认的帧
        + GBN接收方要做的事
          + 如果正确收到n号帧，并且按序，则接收方为n帧发送一个ACK，并将帧内数据交付上层
          + 其他情况都丢弃帧，并为最近按序收到的帧重发ACK。接收方无需缓存任何帧，只需要维护一个信息expectedseqnum(下一个按序接收的帧序号)
      + 选择重传协议 SR
        + (用n个bite对帧编号)2[n-1]>=发送窗口大小>1，2[n-1]>=接收窗口大小>1
          + 发送窗口最好等于接收窗口
        + SR发送方必须响应的三件事
          + 上层的调用
          + 收到一个ACK，则将被确认的帧标记为已接收。如果该帧序号是窗口的下界（最左边第一个窗口的序号），则窗口向前移动到具有最小序号的未确认帧处。如果窗口移动了且有序号在窗口内的未发送帧，则发送这些帧
          + 超时事件 如果发送超时，发送方只会重传一个帧
        + SR接收方要做的事
          + 对于窗口内的帧，接收方将确认一个正确接收的帧而不管其是否按序。失序的帧将被缓存，并且返回给发送方一个该帧的ACK（收谁确认谁），直到所有帧（即序号更小的帧）皆被收到为止，这时才可以将这一批帧上传，并向前移动窗口
          + 收到了窗口序号外（小于窗口下界）的帧，返回一个ASK
          + 其他情况则忽略

+ 信道划分 介质访问控制
  + 数据链路层使用的信道类型
    + 点对点信道
      + PPP协议
    + 广播信道
      + CSMA/CD协议
  + 介质访问控制
    + 静态划分信道 信道划分介质访问控制 （把广播信道转换为互不干扰的点对点信道）
      + 频分多路复用FDM 并行
      + 时分多路复用TDM 并发
        + 统计时分复用STDM 按需动态分配时隙
      + 波分多路复用WDM，就是光的频分多路复用
      + 码分多路复用CDM
    + 动态分配信道
      + 轮询访问介质访问控制
        + 轮询协议 主节点轮流“邀请”从属节点发送数据
        + 令牌传递协议
      + 随机访问介质访问控制 会发送冲突
        + ALOHA协议
        + CSMA协议
        + CSMA/CD协议
        + CSMA/CA协议





+ PPP

  + 帧格式

    | F    | A 地址 | C 保留字段 | 协议 | IP数据报       | FCS  | F    |
    | ---- | ------ | ---------- | ---- | -------------- | ---- | ---- |
    | 7E   | FF     | 03         |      |                |      | 7E   |
    | 1    | 1      | 1          | 2    | 不超过1500byte | 2    | 1    |

  + 传输方式

    + 同步传输
    + 异步传输
      + 零比特填充 只要发现5个联系的1，就加上一个0

+ CSMA/CD 载波监听多点接入/碰撞检测

  + 计算机边发送数据边检测信道上的信号电压大小。当电压摆动值超过一定的阀门值，就认为至少两个站同时发送数据，表明产生了碰撞
  + 以太网端到端往返时延2τ称为争用期/碰撞窗口，通常取51.2us。10Mb/s的以太网，碰撞窗口内可以发送512bit，即64字节（最短有效帧长）。以太网发送数据，若前64字节未发生冲突，则后续数据就不会发生冲突
  + 发生碰撞的站在停止发生数据后，需要退避一个随机时间才能再次发生数据，一般为2τ（基本退避时间）的整数倍

+ 以太网
  + 符合DIX Ethernet V2标准的局域网
  + 集线器
    + 使用电子器件来模拟实际电缆线的工作，这个系统任然像一个以太网那样运行。使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是CSMA/CD协议，共享逻辑上的总线

+ MAC

  + 发往本站的帧，类型有

    + 单播帧 一对一
    + 广播帧 一对全部 ff-ff-ff-ff-ff-ff
    + 多播帧 一对多

  + MAC帧格式

    | 前同步码 | 帧开始定界符 | 目标地址 | 源地址 | 类型 | IP数据报 | FCS  |
    | -------- | ------------ | -------- | ------ | ---- | -------- | ---- |
    |          | 01010101     |          |        |      |          |      |
    | 7        | 1            | 6        | 6      | 2    | 46-1500  | 4    |