# 空安全

## 可空类型与非空类型

在 Kotlin 中，类型系统区分一个引用可以容纳 *null* （可空引用）还是不能容纳（非空引用）

如果要允许为空，我们可以声明一个变量为可空字符串，写作 `String?`

## 在条件中检测 *null*

## 安全的调用

你的第二个选择是安全调用操作符，写作 `?.`

安全调用在链式调用中很有用。如果任意一个属性（环节）为空，这个链式调用就会返回 *null*

安全调用也可以出现在赋值的左侧。这样，如果调用链中的任何一个接收者为空都会跳过赋值，而右侧的表达式根本不会求值

## Elvis 操作符

当我们有一个可空的引用 `b` 时，我们可以说“如果 `b` 非空，我使用它；否则使用某个非空的值”。除了完整的 *if*-表达式，这还可以通过 Elvis 操作符表达，写作 `?:`

如果 `?:` 左侧表达式非空，elvis 操作符就返回其左侧表达式，否则返回右侧表达式。 请注意，当且仅当左侧为空时，才会对右侧表达式求值

请注意，因为 *throw* 和 *return* 在 Kotlin 中都是表达式，所以它们也可以用在 elvis 操作符右侧。这可能会非常方便

## `!!` 操作符

非空断言运算符（`!!`）将任何值转换为非空类型，若该值为空则抛出异常。我们可以写 `b!!` ，这会返回一个非空的 `b` 值 （例如：在我们例子中的 `String`）或者如果 `b` 为空，就会抛出一个 `NPE` 异常

## 安全的类型转换

如果对象不是目标类型，那么常规类型转换可能会导致 `ClassCastException`。 另一个选择是使用安全的类型转换，如果尝试转换不成功则返回 *null*

## 可空类型的集合

如果你有一个可空类型元素的集合，并且想要过滤非空元素，你可以使用 `filterNotNull` 来实现